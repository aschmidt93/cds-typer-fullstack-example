# cds-typer-fullstack-example

This repo is intendend to showcase the usage of cds-typer (https://github.com/cap-js/cds-typer) in a fullstack CAP app written in TypeScript. The types generated by cds-typer are used both on the backend and the frontend. Note that this is still experimental and not complete.

## Installation

After cloning the repo, install the dependencies by running `npm run setup`. This installs the dependencies for each project (root, backend, frontend) and generates the cds types afterwards.

## Structure
 
The structure of the project differs slightly from the usual CAP app. The UI5 app (frontend) is not located inside an `app` folder of the CAP project. Instead, we use a monorepo. The root defines common linting and formatting rules. The CAP app is located under `packages/backend`. The UI5 app is located under `packages/frontend`.

## Starting the app

Open the project using the VSCode workspace (.vscode/workspace.code-workspace). Open a new terminal inside `packages/backend` and run `npm run start-dev` to start the CAP app. Open a new terminal inside `packages/frontend` and run `npm run start-dev` to start the UI5 app.

## Backend

The generated types of cds-typer are used on the backend to enable type safe interaction with services and the database.

The types are generated into `packages/backend/@cds-models` each time a .cds file is saved. The generated files are then used to enable type safety on `cds.services` and `cds.connect`. This is done in `packages/backend/srv/services.d.ts`. Here, we overwrite the definition of `cds.services` and `cds.connect` with our own typesafe definition.

This allows for code completion and compile time errors when using `cds.services` or `cds.connect`

![image](https://github.com/aschmidt93/cds-typer-fullstack-example/assets/139967229/70eb96d7-8654-4d87-b0fd-ac37372b2e75)

When calling actions/functions only existing actions/functions are callable and their parameters and returns are typed.

![image](https://github.com/aschmidt93/cds-typer-fullstack-example/assets/139967229/e8939ed3-a978-40fc-9230-b4a7bd43e935)
![image](https://github.com/aschmidt93/cds-typer-fullstack-example/assets/139967229/16f0570d-8e19-4404-8c50-55dfbce841fc)

Events are currently not typed but this is planned in the future.

## Frontend

The generated types are exposed to the frontend in order to enable typesafe interaction with the backend services. The frontend 'installs' the backend (public folder) as a npm dependency. Therefore, the backend provides a `public` folder which is responsible for exposing the types. The file `packages/backend/public/src/index.ts` defines which parts are exported.

Having this type information from the backend, the frontend defines an abstracted request API that allows to interact with the backend services in a typesafe way. See `packages/frontend/src/common/request.ts` for the implementation.

The usage can be observed in `packages/frontend/src/pages/home/home.controller.ts`.


![image](https://github.com/aschmidt93/cds-typer-fullstack-example/assets/139967229/adf89af2-8baa-4d31-9ef9-1b609a8704c7)

There are currently some limitations.

- No distinction between actions/functions as this information is not available (until next release of cds-typer)
- No distinction between entities und types as this information is not available
- A query builder is not yet implemented for entities


